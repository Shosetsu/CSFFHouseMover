<main class="main">
  <div class="content">
    <h1>卡牌生存：奇幻森林 存档搬家工具</h1>

    <!-- 存档上传区域 -->
    <label class="file-area">
      <img class="svg-icon" [src]="(saveFileName ? 'update' : 'upload') + '.svg'" alt="upload" />
      <p>
        {{
          saveFileName
            ? '正在修改' + saveFileName + '，要更换一个存档吗？'
            : '请先选择一个存档文件以开始编辑'
        }}
      </p>
      <p>
        存档可以在：<span class="red"
          >%userprofile%\AppData\LocalLow\WinterSpring Games\Card Survival - Fantasy
          Forest\Games\</span
        >中找到
      </p>
      <input #save hidden type="file" accept=".json" (change)="selectSaveFile(save)" />
    </label>

    <!-- 高级选项区域 -->
    <div class="selection-area">
      <div class="select-pair">
        <!-- 开关 -->
        <div>
          <mat-checkbox [value]="notHouse() ? 'checked' : ''" (change)="notHouse.set(!notHouse())">
            <span>是否打开高级搬迁功能</span>
          </mat-checkbox>
        </div>

        <!-- 关键字 -->
        @if(notHouse()){
        <mat-form-field class="keyword-select" appearance="outline">
          <mat-label>要搬什么？</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="targetKey"
            [matAutocomplete]="auto"
            placeholder="请输入或选择要搬东西的key"
          />
          <mat-autocomplete #auto="matAutocomplete">
            @for(key of keysets;track key.value){
            <mat-option [value]="key.value">
              <span>{{ key.label }}</span>
            </mat-option>
            }
          </mat-autocomplete>
        </mat-form-field>
        }
      </div>
    </div>

    <!-- 操作区域 -->
    <div class="selection-area">
      <div class="select-pair">
        <!-- 存档中的... -->
        <mat-form-field class="house-select" appearance="outline">
          <mat-label>存档中的{{ notHouse() ? targetKey() : '房子' }}</mat-label>
          <mat-select [(value)]="selectedTarget" placeholder="请选择要搬迁的房子">
            @for(code of targetList();track code.ref){
            <mat-option [value]="code">
              <span>{{ code.label }}</span>
              @if(code.current){<span>（当前）</span>}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <!-- 搬迁至 -->
        <mat-form-field class="destination-select" appearance="outline">
          <mat-label>搬迁至→</mat-label>
          <mat-select [(value)]="selectedDestination" placeholder="请选择新位置">
            @for(code of availableLocations();track code.ref){
            <mat-option [value]="code" [disabled]="code.env === selectedTarget()?.env">
              <span>{{ code.label }}</span>
              @if(code.current){<span>（当前）</span>}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- 操作按钮 -->
      <div class="button-group">
        @if(notHouse()){
        <button
          mat-raised-button
          color="primary"
          (click)="moveCard()"
          [disabled]="!selectedTarget() || !selectedDestination()"
          class="action-btn"
        >
          <img class="svg-icon" src="pin-location.svg" alt="relocate" />
          <span>开始搬{{ targetKey() }}</span>
        </button>
        }@else{
        <button
          mat-raised-button
          color="primary"
          (click)="moveHouse()"
          [disabled]="!selectedTarget() || !selectedDestination()"
          class="action-btn"
        >
          <img class="svg-icon" src="pin-location.svg" alt="relocate" />
          <span>开始搬家</span>
        </button>
        }
        <button
          mat-raised-button
          color="accent"
          (click)="download()"
          [disabled]="!saveFileName"
          class="action-btn"
        >
          <img class="svg-icon" src="save.svg" alt="save" />
          <span>保存存档</span>
        </button>
      </div>
    </div>
  </div>
</main>
